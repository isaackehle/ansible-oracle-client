---
- name: Oracle Client Deployment
  hosts: all
  # remote_user: root
  gather_facts: (ansible_host == 'localhost')

  tasks:
    # - name: Gather Facts now that the server can be reached
    #   setup:
    #   when: ansible_host != 'localhost'

    - name: Get the local hostname (short)
      shell: hostname -s
      connection: local
      register: host_short
      when: ansible_host == 'localhost'

    - name: Get the local hostname (long)
      shell: hostname
      connection: local
      register: host_long
      when: ansible_host == 'localhost'

    - name: Set basic facts, assuming MacOS
      set_fact:
        server_fqdn:            "{{ host_long.stdout }}"
        hostname_short:         "{{ host_short.stdout }}"
        inventory_hostname:     "{{ host_short.stdout }}"
        ansible_distribution:   MacOS
        ansible_architecture:   x86_64
        gather_facts:           no
      when: ansible_host == 'localhost'

    - name: Deploy to the server
      include_tasks: deploy.yml
      when: (((['deploy'] | intersect(flags)) | length > 0) and client_pkg_dir != "")

